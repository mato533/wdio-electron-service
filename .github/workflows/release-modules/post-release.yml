name: Post-Release Tasks

on:
  workflow_call:
    inputs:
      release_tag:
        description: 'The created release tag'
        required: true
        type: string
      releaseVersion:
        description: 'Release type (patch, minor, major, prepatch, preminor, premajor, prerelease)'
        required: true
        type: string
      dryRun:
        description: 'Do not touch or write anything. Show the commands.'
        required: true
        default: false
        type: boolean
    secrets:
      github-token:
        description: 'GitHub token for authentication'
        required: true

jobs:
  post-release:
    runs-on: ubuntu-latest
    steps:
      # Create appropriate milestones based on the release type
      - name: üè∑Ô∏è Create GitHub Milestones
        # Only skip during dry runs (which should be read-only)
        if: ${{ !inputs.dryRun }}
        env:
          GITHUB_TOKEN: ${{ secrets.github-token }}
          RELEASE_TYPE: ${{ inputs.releaseVersion }}
        run: |
          echo "::group::Creating GitHub milestones"
          pnpx tsx scripts/create-milestones.ts
          echo "::endgroup::"

      - name: üìù Create GitHub Release
        uses: softprops/action-gh-release@v2
        with:
          draft: true # Create as draft for manual review
          generate_release_notes: true
          prerelease: ${{ contains(inputs.releaseVersion, 'pre') }}
          repository: webdriverio-community/wdio-electron-service
          tag_name: ${{ inputs.release_tag }}
          token: ${{ secrets.github-token }}
